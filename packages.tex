\usepackage{iftex}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{hyperref}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{gnuplottex}[2016/08/21]%must be before listings package; min date is for compat with tikzexternalize
\usepackage{pgfkeys}
\usepackage{pgfplotstable}
%\pgfplotsset{compat=1.16}
\usepackage{appendix}
\usepackage{minted}
\usepackage{currfile}
\usepackage[color]{coqdoc}
\usepackage{xparse}
\usepackage{xcolor}
\usepackage{xstring}
\usepackage{bussproofs}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{marvosym}
\usepackage{mathtools}
\usepackage{bcprules}
\usepackage{multicol}
\usepackage{apptools}
\usepackage{adjustbox}
%\usepackage[utf8x]{inputenc}
\usepackage{booktabs}   %% For formal tables:
%% http://ctan.org/pkg/booktabs
\usepackage{float}
\usepackage{wrapfig}
%\usepackage{subcaption} %% For complex figures with subfigures/subcaptions
\usepackage{subfig}
%\usepackage{microtype}
\usepackage{textcomp}
\usepackage{attachfile2}
\usepackage{etoolbox}
\usepackage{xpatch}
\usepackage[maxbibnames=99,backend=biber]{biblatex}% backend=bibtex,
%\usepackage{embedfile}
%\usepackage{hypgotoe}
\floatstyle{boxed}
\restylefloat{figure}
\usepackage{verbatim}
\usepackage{upquote}
\usepackage{enumerate}
\usepackage{cleveref}
\usepackage[all,cmtip]{xy}
\usepackage{stmaryrd}
%\usepackage[autogenerated,mathletters]{ucs}
%Package inputenc Warning: inputenc package ignored with utf8 based engines.
\ifLuaTeX
\else
\usepackage[utf8]{inputenc}
\fi
\usepackage{textgreek}
\usepackage{newunicodechar}
\newunicodechar{Œª}{\ensuremath{\lambda}}
\newunicodechar{‚àÄ}{\ensuremath{\forall}}
\newunicodechar{‚àÉ}{\ensuremath{\exists}}
\newunicodechar{‚Üí}{\ensuremath{\to}}
\newunicodechar{‚áí}{\ensuremath{\Rightarrow}}
\newunicodechar{√ó}{\ensuremath{\times}}
\newunicodechar{‚àß}{\ensuremath{\wedge}}
\newunicodechar{Œì}{\ensuremath{\Gamma}}
\newunicodechar{‚ä¢}{\ensuremath{\vdash}}
\newunicodechar{ùîπ}{\ensuremath{\mathbb{B}}}
\newunicodechar{‚ÑÇ}{\ensuremath{\mathbb{C}}}
\newunicodechar{‚Ñï}{\ensuremath{\mathbb{N}}}
\newunicodechar{‚Ñô}{\ensuremath{\mathbb{P}}}
\newunicodechar{‚Ñö}{\ensuremath{\mathbb{Q}}}
\newunicodechar{‚Ñù}{\ensuremath{\mathbb{R}}}
\newunicodechar{‚Ñ§}{\ensuremath{\mathbb{Z}}}
\newunicodechar{‚Å∞}{\ensuremath{{}^0}}
\newunicodechar{¬π}{\ensuremath{{}^1}}
\newunicodechar{¬≤}{\ensuremath{{}^2}}
\newunicodechar{¬≥}{\ensuremath{{}^3}}
\newunicodechar{‚Å¥}{\ensuremath{{}^4}}
\newunicodechar{‚Åµ}{\ensuremath{{}^5}}
\newunicodechar{‚Å∂}{\ensuremath{{}^6}}
\newunicodechar{‚Å∑}{\ensuremath{{}^7}}
\newunicodechar{‚Å∏}{\ensuremath{{}^8}}
\newunicodechar{‚Åπ}{\ensuremath{{}^9}}
\newunicodechar{‚ÇÄ}{\ensuremath{{}_0}}
\newunicodechar{‚ÇÅ}{\ensuremath{{}_1}}
\newunicodechar{‚ÇÇ}{\ensuremath{{}_2}}
\newunicodechar{‚ÇÉ}{\ensuremath{{}_3}}
\newunicodechar{‚ÇÑ}{\ensuremath{{}_4}}
\newunicodechar{‚ÇÖ}{\ensuremath{{}_5}}
\newunicodechar{‚ÇÜ}{\ensuremath{{}_6}}
\newunicodechar{‚Çá}{\ensuremath{{}_7}}
\newunicodechar{‚Çà}{\ensuremath{{}_8}}
\newunicodechar{‚Çâ}{\ensuremath{{}_9}}

\usepgfplotslibrary{units}
\usepgfplotslibrary{external}
\tikzexternalize

\hypersetup{raiselinks=false,colorlinks=false,linkcolor=black} % undo coqdoc stuff

% Minted red box around greek characters - https://tex.stackexchange.com/a/343506/2066
\usemintedstyle{bw}
\makeatletter
\AtBeginEnvironment{minted}{\dontdofcolorbox}
\def\dontdofcolorbox{\renewcommand\fcolorbox[4][]{##4}}
\xpatchcmd{\inputminted}{\minted@fvset}{\minted@fvset\dontdofcolorbox}{}{}
\xpatchcmd{\mintinline}{\minted@fvset}{\minted@fvset\dontdofcolorbox}{}{}
\makeatother

\renewcommand{\chapterautorefname}{Chapter}
\renewcommand{\sectionautorefname}{Section}
\renewcommand{\subsectionautorefname}{Subsection}
\renewcommand{\subsubsectionautorefname}{Subsubsection}
\newcommand{\appendixautoref}[1]{\bgroup
\def\chapterautorefname{Appendix}%
\def\sectionautorefname{Appendix}%
\def\subsectionautorefname{Appendix}%
\def\subsubsectionautorefname{Appendix}%
\newcommand{\subfigureautorefname}{\figureautorefname}
\autoref{#1}%
\egroup}

%{\catcode`\_=12 \gdef\textunderscore{_}}
%\def\_{\textunderscore}

% from http://tex.stackexchange.com/a/218441/2066
\makeatletter
\newcommand{\dashover}[2][\mathop]{#1{\mathpalette\df@over{{\dashfill}{#2}}}}
\newcommand{\fillover}[2][\mathop]{#1{\mathpalette\df@over{{\solidfill}{#2}}}}
\newcommand{\df@over}[2]{\df@@over#1#2}
\newcommand\df@@over[3]{%
  \vbox{
    \offinterlineskip
    \ialign{##\cr
      #2{#1}\cr
      \noalign{\kern1pt}
      $\m@th#1#3$\cr
    }
  }%
}
\newcommand{\dashfill}[1]{%
  \kern-.5pt
  \xleaders\hbox{\kern.5pt\vrule height.4pt width \dash@width{#1}\kern.5pt}\hfill
  \kern-.5pt
}
\newcommand{\dash@width}[1]{%
  \ifx#1\displaystyle
    2pt
  \else
    \ifx#1\textstyle
      1.5pt
    \else
      \ifx#1\scriptstyle
        1.25pt
      \else
        \ifx#1\scriptscriptstyle
          1pt
        \fi
      \fi
    \fi
  \fi
}
\newcommand{\solidfill}[1]{\leaders\hrule\hfill}
\makeatother

\newcommand{\aswidthof}[2]{\rlap{#1}\hphantom{#2}}

\newcommand{\coqbug}[1]{\href{https://github.com/coq/coq/issues/#1}{\##1}}
\newcommand{\coqpr}[1]{\href{https://github.com/coq/coq/issues/#1}{\##1}}
\newcommand{\ocamlbug}[1]{\href{https://github.com/ocaml/ocmal/issues/#1}{\##1}}
\newcommand{\kw}[1]{{\fontfamily{pcr}\selectfont\textbf{#1}}}
\newcommand{\tactic}[1]{\texttt{#1}}
\newcommand{\finishingtactic}[1]{\tactic{#1}}
\newcommand{\tacREFLEXIVITY}{\finishingtactic{reflexivity}}
\newcommand{\strcolored}[1]{\texttt{\textcolor{DarkGreen}{#1}}}
\newcommand{\stropen}{\texttt{"}}
\newcommand{\strclose}{\texttt{"}}
\newcommand{\str}[1]{\stropen\strcolored{#1}\strclose}
\newcommand{\regex}[1]{\texttt{#1}}
\newcommand{\nt}[1]{\texttt{#1}}
\newcommand{\terminal}[1]{\texttt{\textquotesingle\textcolor{DarkGreen}{#1}\textquotesingle}}
\newcommand{\production}[1]{[#1]}
\newcommand{\productions}[1]{#1}
\newcommand{\coqtype}[1]{\texttt{#1}}
\newcommand{\False}{\ensuremath{\bot}}
\newcommand{\True}{\ensuremath{\top}}
\newcommand{\Unit}{\ensuremath{\top}}
\newcommand{\true}{\texttt{true}}
\newcommand{\false}{\texttt{false}}
\newcommand{\unittt}{\texttt{()}}
\newcommand{\String}{\texttt{String}}
\newcommand{\Bool}{\texttt{Bool}}
\newcommand{\nat}{\ensuremath{\mathbb{N}}}
\newcommand{\textnbsp}{\ifmmode\else~\fi}
\newcommand{\typeprodsep}{\ensuremath{\times}}
\newcommand{\typeprod}[2]{#1\textnbsp\typeprodsep\textnbsp#2}
\newcommand{\typesumsep}{\ensuremath{+}}
\newcommand{\typesum}[2]{#1\textnbsp\typesumsep\textnbsp#2}
\newcommand{\fname}[1]{\texttt{#1}}
\newcommand{\farg}[1]{\textcolor{violet}{\texttt{#1}}}
\newcommand{\oftypesep}{:}
\newcommand{\oftype}[2]{#1\textnbsp\oftypesep\textnbsp#2}
\newcommand{\nil}{\texttt{[]}}
\newcommand{\cons}[2]{#1::#2}
%\newcommand{\hole}{\texttt{\_}}
\newcommand{\termhole}{\texttt{\_}}
\newcommand{\defeq}{\coloneqq}
\newcommand{\testeq}{=}
\newcommand{\booland}{\mathrel{\texttt{\&\&}}}
\newcommand{\boolor}{\mathrel{\texttt{||}}}
\newcommand{\letinlet}{\kw{let}~}
\newcommand{\letinkw}[1]{\letinlet#1~\kw{in}}
\newcommand{\strcat}[2]{#1#2}
\newcommand{\llstrcat}[2]{#1 \ensuremath{\cdot} #2}
\newcommand{\afun}[2]{\ensuremath{\lambda~#1.~#2}}
\newcommand{\typeto}{\ensuremath{\to}}
\newcommand{\indname}[1]{\texttt{#1}}
\newcommand{\Type}{\kw{Type}}
\newcommand{\Prop}{\kw{Prop}}
\newcommand{\constructorname}[1]{\texttt{#1}}
\newcommand{\Nonterminal}{\indname{Nonterminal}}
\newcommand{\Terminal}{\texttt{Char}}
\newcommand{\parsetreetype}[2]{\ensuremath{\dashover[]{#2 \in #1}}}
\newcommand{\minparsetreeannot}[2]{\ensuremath{<(#1,#2)}}
\newcommand{\minparsetreetype}[4]{\ensuremath{\dashover[]{#4 \in #3}^{~\minparsetreeannot{#1}{#2}}}}
\newcommand{\typelist}[1]{\texttt{[}#1\texttt{]}}
\newcommand{\typelistp}[1]{\typelist{#1}} % parenthesized \typelist, if need be (so, `list (foo)` instead of `list foo`)
\newcommand{\valuelist}[1]{\texttt{[}#1\texttt{]}}
\newcommand{\valuelistm}[1]{\ensuremath{\big[#1\big]}} % math mode
\newcommand{\typeoption}[2][~~]{\indname{option}#1#2}
\newcommand{\typeoptionp}[1]{\typeoption[~]{(#1)}} % parenthesized \typeoption, if need be
\newcommand{\None}{\constructorname{None}}
\newcommand{\Some}[1]{\constructorname{Some}~#1}
\newcommand{\Somep}[1]{\constructorname{Some}~(#1)}
\newcommand{\ParseQuery}{\indname{ParseQuery}}
\newcommand{\inl}[1]{\constructorname{inl}~#1}
\newcommand{\inlp}[1]{\inl{(#1)}}
\newcommand{\inr}[1]{\constructorname{inr}~#1}
\newcommand{\inrp}[1]{\inr{(#1)}}
\newcommand{\fst}[1]{\texttt{fst}~#1}
\newcommand{\snd}[1]{\texttt{snd}~#1}
\newcommand{\proj}[2]{#2\ensuremath{_{\kw{#1}}}}
\newcommand{\precaseof}{\kw{case}~~~}
\newcommand{\caseof}[1]{\precaseof#1~~~\kw{of}}
\newcommand{\acase}[3][\big]{~#1|{~{#2}~~\ensuremath{\to}~~{#3}}}
\newcommand{\cif}{\kw{if}~~~}
\newcommand{\cifindent}[1][]{\aswidthof{#1}{\kw{then}}~~~}
\newcommand{\cthen}{\cifindent[\kw{then}]}
\newcommand{\celse}{\cifindent[\kw{else}]}
\newcommand{\cancomputeto}[2]{#1~~\ensuremath{\rightsquigarrow}~~#2}
\newcommand{\Rtac}{\texorpdfstring{\ensuremath{\mathcal{R}_{\text{\textit{tac}}}}}{Rtac}}
\newcommand{\Ltac}{\texorpdfstring{\ensuremath{\mathcal{L}_{\text{\textit{tac}}}}}{Ltac}}
\newcommand{\coqgroupb}[1]{\texttt{\ensuremath{\left(\text{#1}\right)}}}
\newcommand{\coqgroup}[1]{\texttt{(#1)}}
\newcommand{\functiondefeq}{~\ensuremath{\operatorname{\texttt{\ensuremath{\defeq}}}}~}

% highlight overfull hboxes
%\overfullrule=5pt


% http://tex.stackexchange.com/a/183682/2066
\makeatletter

% define a macro \Autoref to allow multiple references to be passed to \autoref
\newcommand\Autoref[1]{\@first@ref#1,@}
\def\@throw@dot#1.#2@{#1}% discard everything after the dot
\def\@set@refname#1{%    % set \@refname to autoefname+s using \getrefbykeydefault
    \edef\@tmp{\getrefbykeydefault{#1}{anchor}{}}%
    \def\@refname{\@nameuse{\expandafter\@throw@dot\@tmp.@autorefname}s}%
}
\def\@first@ref#1,#2{%
  \ifx#2@\autoref{#1}\let\@nextref\@gobble% only one ref, revert to normal \autoref
  \else%
    \@set@refname{#1}%  set \@refname to autoref name
    \@refname~\ref{#1}% add autoefname and first reference
    \let\@nextref\@next@ref% push processing to \@next@ref
  \fi%
  \@nextref#2%
}
\def\@next@ref#1,#2{%
   \ifx#2@ and~\ref{#1}\let\@nextref\@gobble% at end: print and+\ref and stop
   \else, \ref{#1}% print  ,+\ref and continue
   \fi%
   \@nextref#2%
}

\makeatother
\allowdisplaybreaks

% from reification-by-parametricity


% begin appendix autoref patch [\autoref subsections in appendix](https://tex.stackexchange.com/questions/149807/autoref-subsections-in-appendix)
\makeatletter
\patchcmd{\hyper@makecurrent}{%
    \ifx\Hy@param\Hy@chapterstring
    \let\Hy@param\Hy@chapapp
    \fi
}{%
\iftoggle{inappendix}{%true-branch
    % list the names of all sectioning counters here
    \@checkappendixparam{chapter}%
    \@checkappendixparam{section}%
    \@checkappendixparam{subsection}%
    \@checkappendixparam{subsubsection}%
    \@checkappendixparam{paragraph}%
    \@checkappendixparam{subparagraph}%
}{}%
}{}{\errmessage{failed to patch}}

\newcommand*{\@checkappendixparam}[1]{%
    \def\@checkappendixparamtmp{#1}%
    \ifx\Hy@param\@checkappendixparamtmp
    \let\Hy@param\Hy@appendixstring
    \fi
}
\makeatletter

\newtoggle{inappendix}
\togglefalse{inappendix}

\apptocmd{\appendix}{\toggletrue{inappendix}}{}{\errmessage{failed to patch}}
%\apptocmd{\subappendices}{\toggletrue{inappendix}}{}{\errmessage{failed to patch}}
% end appendix autoref patch


\newcommand{\letindots}{\texttt{let \ldots\space in \ldots}}
\newcommand{\letin}[1][{\ensuremath{\cdots}}{\ensuremath{\cdots}}]{%
    \texttt{let }\@firstoftwo#1\texttt{ in }\@secondoftwo#1
}


\newcommand{\ttifycoqdoc}[1]{%
\expandafter\let\csname old\string#1\endcsname#1%
\renewcommand{#1}[1]{{%
\let\textrm\texttt
\let\textsf\texttt
\let\textit\texttt
\let\textsl\texttt
\csname old\string#1\endcsname{##1}%
}}%
}

\ttifycoqdoc\coqdocvar
\ttifycoqdoc\coqdoccst
\ttifycoqdoc\coqdocind
\ttifycoqdoc\coqdocconstr
\ttifycoqdoc\coqdocmod
\ttifycoqdoc\coqdocax

\makeatletter
\renewenvironment{coqdoccode}{\tt\@vobeyspaces}{}
\makeatother

\newcommand{\coqinput}[1]{{%
\let\oldsubsection\subsection
\renewcommand{\section}[1]{\oldsubsection{##1 (\texttt{#1})} \label{sec:#1}}%
\renewcommand{\subsection}[1]{\subsubsection{##1} \hfill$\left.\right.$ \linebreak}%
\input{#1.tex}%
}}
\newcommand{\subcoqinput}[1]{{%
\renewcommand{\section}[1]{\subsubsection{##1 (\texttt{#1})} \label{sec:#1}\hfill$\left.\right.$ \linebreak}%
\renewcommand{\subsection}[1]{\paragraph{##1} \hfill$\left.\right.$ \linebreak}%
\input{#1.tex}%
}}
\newcommand{\ocamlinput}[2]{{%
\subsection{#1 (\texttt{\detokenize{#2}})} \label{sec:#2}
\verbatiminput{benchmark/#2}%
}}
\newcommand{\subocamlinput}[2]{{%
\subsubsection{#1 (\texttt{\detokenize{#2}})} \label{sec:#2}\hfill$\left.\right.$ \linebreak
\verbatiminput{benchmark/#2}%
}}

% https://tex.stackexchange.com/a/121871/2066
\newcommand*{\fullref}[1]{\hyperref[{#1}]{\autoref*{#1} (\nameref*{#1})}} % One single link

% https://groups.google.com/d/msg/latexusersgroup/07qZP63GY3k/cu53DqbAhkYJ
\makeatletter
\newcommand{\Chapter}[1]{\split@chapter#1:}
\def\split@chapter#1:#2:{\chapter[#1]{#1\\[1ex]\huge#2}}
\makeatother



% from rewriting

%\usepackage{usebib}
%\newbibfield{author}
%\newbibfield{title}
%\bibinput{rewriting-lower}
%\newcommand{\citetitle}[1]{\emph{\usebibentry{#1}{title}}\nocite{#1}}
\makeatletter
\newcommand{\einput}[1]{\@@input #1 \space}
\newcommand{\beginTikzpictureStamped}[2][]{%
    {%
        \everyeof{\noexpand}% IDK why \noexpand is the magic one, but I got it from http://mirrors.ibiblio.org/CTAN/macros/latex/contrib/oberdiek/catchfile.pdf
        \long\xdef\@tikzstamp{#2}%
    }%
    \def\@dobegintikzpicture{\begin{tikzpicture}[#1]}%
    \expandafter\@dobegintikzpicture\expandafter\def\expandafter\tikzstamp\expandafter{\@tikzstamp}%
}
\newcommand{\TikzpictureStamped}[3][]{\beginTikzpictureStamped[#1]{#2}#3\end{tikzpicture}}%
\makeatother
\newcommand{\asserteq}[2]{\ifthenelse{\equal{#1}{#2}}{}{\GenericError{}{Not equal: \detokenize{#1} != \detokenize{#2}}{}{}}}

%% from pandoc
\providecommand{\tightlist}{%
    \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

%% exponential regression fit
\makeatletter
% https://tex.stackexchange.com/a/50113/2066
\newcommand*{\IsInteger}[3]{%
    \IfStrEq{#1}{ }{%
        #3% is a blank string
    }{%
    \IfInteger{#1}{#2}{#3}%
}%
}%
\newcommand{\pgftognucolumnset}[2]{%
    \IsInteger{\pgfkeysvalueof{#1}}{%
        \edef#2{\pgfkeysvalueof{#1}}%
    }{%
    \edef#2{(column("\pgfkeysvalueof{#1}"))}%
}%
}
\makeatletter
% \addplotexponentialregression[params for \addplot][default settings for a and b, also for x and y columns]{table file}
\NewDocumentCommand{\addplotexponentialregression}{ O{no markers} o m}{%
    \pgfkeyssetvalue{/addplotexponentialregression/x}{0}
    \pgfkeyssetvalue{/addplotexponentialregression/y}{1}
    \pgfkeyssetvalue{/addplotexponentialregression/a}{1}
    \pgfkeyssetvalue{/addplotexponentialregression/b}{1}
    \pgfkeys{/addplotexponentialregression/.cd,#2}
    \pgftognucolumnset{/addplotexponentialregression/x}{\@addplotexponentialregression@colx}%
    \pgftognucolumnset{/addplotexponentialregression/y}{\@addplotexponentialregression@coly}%
    \edef\@addplotexponentialregression@inita{\pgfkeysvalueof{/addplotexponentialregression/a}}%
    \edef\@addplotexponentialregression@initb{\pgfkeysvalueof{/addplotexponentialregression/b}}%
    \addplot [#1] gnuplot [raw gnuplot] { % allows arbitrary gnuplot commands
        f(x) = a*exp(b*x);     % Define the function to fit
        % Set reasonable starting values here
        a=\@addplotexponentialregression@inita;
        b=\@addplotexponentialregression@initb;
        fit f(x) '#3' u \@addplotexponentialregression@colx:\@addplotexponentialregression@coly\space via a,b; % Select the file
        stats '#3' u \@addplotexponentialregression@colx;
        plot [x=STATS_min:STATS_max] f(x);    % Specify the range to plot
        set print "#3-parameters.dat";  % Open a file to save the parameters
        print a, b;                  % Write the parameters to file
    };
    \pgfplotstableread{#3-parameters.dat}\parameters % Open the file Gnuplot wrote
    \pgfplotstablegetelem{0}{0}\of\parameters \pgfmathsetmacro\pgfplotstableregressiona{\pgfplotsretval} % Get first element, save into \pgfplotstableregressiona
    \pgfplotstablegetelem{0}{1}\of\parameters \pgfmathsetmacro\pgfplotstableregressionb{\pgfplotsretval}
}
\makeatother

\input{todo}
